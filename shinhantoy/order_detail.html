<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>상품 상세 페이지</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.6.3.min.js"
      integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU="
      crossorigin="anonymous"
    ></script>
    <script>
      function submitComment() {
        const search = new URLSearchParams(location.search);
        const order_id = search.get("order_id");
        $.ajax({
          type: "POST",
          url: "http://127.0.0.1:8000/api/order/" + order_id + "/comment",
          data: {
            order: order_id,
            content: $("#content").val(),
          },
          beforeSend: function (xhr) {
            xhr.setRequestHeader("Authorization", "JWT " + $("#token").val());
          },
          success: (result) => {
            alert("댓글 업로드 됨");
            document.location.reload();
          },
          error: (result) => {
            console.error(result);
          },
        });
      }
      $(document).ready(function () {
        const search = new URLSearchParams(location.search);
        const order_id = search.get("order_id");
        if (order_id > 0) {
          $.get("http://127.0.0.1:8000/api/product/" + order_id).then(
            (result) => {
              $("#order_ord_ymd").text(result.ord_ymd);
              $("#order_acct_mang_dbrn_code").text(result.acct_mang_dbrn_code);
              $("#order_ord_no").text(result.ord_no);
              $("#order_acct_no").text(result.acct_no);
              $("#order_callv_type_code").text(result.callv_type_code);
              $("#order_sell_buy_tp_code").text(result.sell_buy_tp_code);
              $("#order_stbd_code").text(result.stbd_code);
              $("#order_ord_qty").text(result.ord_qty);
              $("#order_ord_uv").text(result.ord_uv);
              $("#order_mrgn_base_uv").text(result.mrgn_base_uv);
            }
          );
          $.get(
            "http://127.0.0.1:8000/api/product/" + ord_no + "/comment"
          ).then((result) => {
            $("#comments").html("");

            for (let i = 0; i < result.results.length; i++) {
              const comment = result.results[i];

              $("#comments").append(
                $(`<li class="list-group-item">
                        ${comment.content}<br><br>
                        ${comment.member_username} (${comment.tstamp})
                    </li>`)
              );
            }
          });
        }
      });
    </script>
  </head>
  <body>
    <div class="container">
      <h1 id="productName" class="text-center"></h1>
      <ul>
        <li>ord_ymd: <span id="order_ord_ymd"></span></li>
        <li>
          acct_mang_dbrn_code: <span id="order_acct_mang_dbrn_code"></span>
        </li>
        <li>ord_no: <span id="order_ord_no"></span></li>
        <li>acct_no: <span id="order_acct_no"></span></li>
        <li>callv_type_code: <span id="order_callv_type_code"></span></li>
        <li>sell_buy_tp_code: <span id="order_sell_buy_tp_code"></span></li>
        <li>stbd_code: <span id="order_stbd_code"></span></li>
        <li>ord_qty: <span id="order_ord_qty"></span></li>
        <li>ord_uv: <span id="order_ord_uv"></span></li>
        <li>mrgn_base_uv: <span id="order_mrgn_base_uv"></span></li>
      </ul>
      <hr />
      <ul class="list-group list-group-flush" id="comments">
        <li class="list-group-item">댓글 내용입니다.<br /><br /></li>
      </ul>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
